# Drugi zadatak

```{r}
library(readr)
```

```{r}
dataset <- read_csv("preprocessed_data.csv")
```

```{r}

basement_area = dataset$TotalBsmtSF

quartiles = quantile(basement_area, probs=c(.25, .75), na.rm=FALSE)
IQR = IQR(basement_area)
lower <- quartiles[1] - 1.5*IQR
upper <- quartiles[2] + 1.5*IQR 

dataset = subset(dataset, basement_area > lower & basement_area < upper)

basement_area = dataset$TotalBsmtSF

hist(basement_area, breaks = 20)
```
Dani su podaci veličine podruma i kvart u kojoj se nekretnina nalazi.

```{r}
neighbourhoods = dataset$Neighborhood
unique_neighbourhoods <- sort(unique(neighbourhoods))
```

Postoji 25 različitih kvartova za koje ispitujemo utječu li na veličinu podruma
```{r}
barplot(table(x= basement_area, y = neighbourhoods))
```
```{r}
counts <- table(neighbourhoods)
counts
```


# ANOVA

Koristit ćemo statistički test ANOVA kako bi testirali sredinu više populacija. U našem slučaju imamo 25 kvartova gdje ćemo za svaki kvart izračunati srednju veličine garaže. 

#U analizi varijance pretpostavlja se da je ukupna varijabilnost u podatcima posljedica varijabilnosti podataka unutar svakog pojedine
#grupe (populacije) i varijabilnosti između različitih grupa. Varijabilnost unutar pojedinog uzorka je rezultat slučajnosti, a ako
#postoje razlike u sredinama populacija, one će biti odražene u varijabilnosti među grupama. Jedan od glavnih ciljeva analize
#varijance je ustanoviti jesu li upravo te razlike između grupa samo posljedica slučajnosti ili je statistički značajna.

Pretpostavke ANOVA-e su:

- nezavisnost pojedinih podataka u uzorcima,
- normalna razdioba podataka,
- homogenost varijanci među populacijama. 

Provjera normalnosti može se za svaku pojedinu grupu napraviti KS testom ili Lillieforsovom inačicom KS testa. U ovom slučaju razmatrat ćemo kvart kao nezavisnu varijablu i veličinu garaže kao zavisnu varijablu.


```{r test pretpostavki - normalnost}
require(nortest)
lillie.test(basement_area)

# odbacivanje redataka koji ne podliježu normalnoj distribuciji
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="Blmngtn"])
#lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="Blueste"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="BrDale"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="BrkSide"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="ClearCr"])
#lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="CollgCr"])
#lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="Crawfor"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="Edwards"])
#lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="Gilbert"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="IDOTRR"])
#lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="MeadowV"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="Mitchel"])
#lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="NAmes"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="NoRidge"])
#lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="NPkVill"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="NridgHt"])
#lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="NWAmes"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="OldTown"])
#lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="Sawyer"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="SawyerW"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="StoneBr"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="SWISU"])
lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="Timber"])
#lillie.test(basement_no_outliers[dataset_no_outliers$Neighborhood=="Veenker"])
```


```{r test pretpostavki - normalnost}
not_normal_neighbourhoods <- c("Blueste", "CollgCr", "Crawfor", "Gilbert", "MeadowV", "NAmes", "NPkVill", "NWAmes", "Sawyer")
nrow(dataset)
dataset <- subset(dataset, !Neighborhood %in% not_normal_neighbourhoods)
nrow(dataset)
```

```{r test pretpostavki - homogenost varijanci}

# Testiranje homogenosti varijance uzoraka Bartlettovim testom
bartlett.test(basement_area ~ neighbourhoods)
```

Provjerimo postoje li razlike u veličini podruma za različite razine kvartove.

```{r test razlike u veličini podruma}

# Graficki prikaz podataka
boxplot(basement_area ~ neighbourhoods)

# Test
a = aov(dataset$TotalBsmtSF ~ dataset$Neighborhood)
summary(a)

```


Grafički prikaz sugerira da postoji jasna razlika između grupa, što potvrđuje i ANOVA. Kako bismo procijenili model koji pomoću varijable o školovanju klijenata objašnjava njihov prihod?

```{r linearni model}

# Linearni model
model = lm(basement_area ~ neighbourhoods, data = dataset)
summary(model)
anova(model)

```